---
title: åœ¨iOSä¸­å¦‚ä½•æ­£ç¡®çš„å®ç°è¡Œé—´è·ä¸è¡Œé«˜
categories: iOS
tags: [iOS, UILabel, NSAttributedString, NSParagraphStyle, line spacing, line height, è¡Œé—´è·, è¡Œé«˜]
date: 2018-03-26
---

æœ€è¿‘å‡†å¤‡ç»™ [VirtualView-iOS](https://github.com/alibaba/VirtualView-iOS) çš„æ–‡æœ¬å…ƒç´ æ–°å¢ä¸€ä¸ª lineHeight å±æ€§ï¼Œä»¥ä¾¿å’Œ [VirtualView-Android](https://github.com/alibaba/Virtualview-Android) é…åˆæ—¶èƒ½æ›´ç²¾ç¡®çš„ä¿è¯åŒå¹³å°çš„ä¸€è‡´æ€§ã€‚é¢å‘ Google ä»¥åŠ Stack Overflow ç¼–ç¨‹äº†ä¸€ä¼šåå‘ç°ï¼Œèƒ½æŸ¥åˆ°çš„èµ„æ–™å¤§éƒ¨åˆ†æ˜¯ä»‹ç»å¦‚ä½•å®ç° lineSpacing å±æ€§ï¼Œè€Œä¸æ˜¯ lineHeightã€‚ä½†æ˜¯æˆ‘å°±æ˜¯å› ä¸º iOS å’Œ Android çš„é»˜è®¤ lineSpacing ä¸ä¸€è‡´æ‰€ä»¥æ‰æƒ³å®ç°ä¸ª lineHeight å•Šï¼è¿˜æ˜¯éœ€è¦è‡ªå·±åŠ¨æ‰‹ä¸°è¡£è¶³é£Ÿï¼Œé¡ºå¸¦æ•´ç†æˆæ–‡ç« é€ ç¦åäººã€‚

<!--more-->

# å…³äºè¡Œé—´è· lineSpacing

å…ˆè´´å‡ºä¸€å¼  iOS ä¸­ UILabel çš„é»˜è®¤æ’ç‰ˆæ ·å¼ï¼š

![26-A](/2018/03/26-A.png)

å¤§å®¶ä¹Ÿéƒ½èƒ½çœ‹å‡ºæ¥ï¼Œé»˜è®¤çš„æ’ç‰ˆæ ·å¼ä¸­ï¼Œæ–‡æœ¬çš„è¡Œé—´è·å¾ˆå°ï¼Œæ˜¾å¾—æ–‡æœ¬ååˆ†æŒ¤ã€‚

è¿™ç§æ—¶å€™ï¼Œè®¾è®¡å¸ˆå°±ä¼šæå‡ºè¡Œé—´è·çš„éœ€æ±‚ï¼Œå¸Œæœ›è®©æ–‡æœ¬å±•ç¤ºå¾—æ›´ç¾è§‚ã€‚ç±»ä¼¼çš„æ ‡æ³¨å°±ä¼šåƒè¿™æ ·ï¼š

![26-B](/2018/03/26-B.png)

å¯¹äºå¦‚æ­¤åˆç†çš„è¦æ±‚ï¼Œæˆ‘ä»¬å½“ç„¶æ˜¯è¦æ”¯æŒï¼Œ~~ç‰¹åˆ«æ˜¯è®¾è®¡å¸ˆè¿˜æ˜¯æ¼‚äº®å°å§å§çš„æƒ…å†µä¸‹~~ã€‚é€šå¸¸æ¥è¯´æ—¢ç„¶è®¾è®¡å¸ˆè¦æ±‚çš„æ˜¯è¡Œé—´è·ï¼Œé‚£ä¹ˆæˆ‘ä»¬ç›´æ¥è®¾ç½® lineSpacing å°±å¥½ã€‚ä½†æ˜¯ UILabel æ˜¯æ²¡æœ‰è¿™ä¹ˆä¸€ä¸ªç›´æ¥æš´éœ²çš„å±æ€§çš„ï¼Œæƒ³è¦ä¿®æ”¹ lineSpacingï¼Œæˆ‘ä»¬éœ€è¦å€ŸåŠ© NSAttributedString æ¥å®ç°ï¼Œç¤ºæ„ä»£ç ï¼š

```
NSMutableParagraphStyle *paragraphStyle = [NSMutableParagraphStyle new];
paragraphStyle.lineSpacing = 10;
NSMutableDictionary *attributes = [NSMutableDictionary dictionary];
[attributes setObject:paragraphStyle forKey:NSParagraphStyleAttributeName];
label.attributedText = [[NSAttributedString alloc] initWithString:label.text attributes:attributes];
```

è¿è¡Œä¸€ä¸‹è§‚å¯Ÿæ•ˆæœï¼š

![26-C](/2018/03/26-C.png)

è™½ç„¶ç”¨æˆ‘ä»¬çš„çœ¼ç›çœ‹ä¸Šå»å¥½åƒæ²¡ä»€ä¹ˆé—®é¢˜ï¼Œä½†æ˜¯è®¾è®¡å¸ˆçš„ç«çœ¼é‡‘ç›ä¸€ä¸‹å°±èƒ½çœ‹å‡ºæ¥ï¼Œå’Œè®¾è®¡ç¨¿è¦æ±‚çš„æœ‰å·®è·ï¼š

![26-D](/2018/03/26-D.png)

æ€ä¹ˆä¼šæˆè¿™æ ·ï¼ï¼Ÿè¿™è·Ÿè¯´å¥½çš„ä¸ä¸€æ ·å¯¹ä¸å¯¹ï¼ï¼Ÿä¸è¦æ…Œï¼Œæˆ‘æ¥ç»†ç»†è§£é‡Šä¸‹ã€‚

# æ­£ç¡®çš„å®ç°è¡Œé—´è·

å…ˆçœ‹ç¤ºæ„å›¾ï¼š

![26-E](/2018/03/26-E.png)

çº¢è‰²åŒºåŸŸæ˜¯é»˜è®¤ç»˜åˆ¶å•è¡Œæ–‡æœ¬ä¼šå ç”¨çš„åŒºåŸŸï¼Œå¯ä»¥çœ‹åˆ°æ–‡å­—çš„ä¸Šä¸‹æ˜¯æœ‰ä¸€äº›ç•™ç™½çš„ï¼ˆè“è‰²å’Œçº¢è‰²é‡å çš„éƒ¨åˆ†ï¼‰ã€‚è®¾è®¡å¸ˆæ˜¯æƒ³è¦è“è‰²åŒºåŸŸé«˜åº¦ä¸º 10ptï¼Œè€Œæˆ‘ä»¬ç›´æ¥è®¾ç½® lineSpacing ä¼šå°†ä¸¤è¡Œçº¢è‰²åŒºåŸŸä¸­é—´çš„ç»¿è‰²åŒºåŸŸé«˜åº¦è®¾ç½®ä¸º 10ptï¼Œè¿™å°±æ˜¯é—®é¢˜çš„æ ¹æºäº†ã€‚

é‚£ä¹ˆè¿™ä¸ªçº¢è‰²çš„åŒºåŸŸé«˜åº¦æ˜¯å¤šå°‘å‘¢ï¼Ÿç­”æ¡ˆæ˜¯ `label.font.lineHeight`ï¼Œå®ƒæ˜¯ä½¿ç”¨æŒ‡å®šå­—ä½“ç»˜åˆ¶å•è¡Œæ–‡æœ¬çš„åŸå§‹è¡Œé«˜ã€‚

çŸ¥é“äº†åŸå› åé—®é¢˜å°±å¥½è§£å†³äº†ï¼Œæˆ‘ä»¬éœ€è¦åœ¨è®¾ç½® lineSpacing æ—¶ï¼Œå‡å»è¿™ä¸ªç³»ç»Ÿçš„è‡ªå¸¦è¾¹è·ï¼š

```
NSMutableParagraphStyle *paragraphStyle = [NSMutableParagraphStyle new];
paragraphStyle.lineSpacing = 10 - (label.font.lineHeight - label.font.pointSize);
NSMutableDictionary *attributes = [NSMutableDictionary dictionary];
[attributes setObject:paragraphStyle forKey:NSParagraphStyleAttributeName];
label.attributedText = [[NSAttributedString alloc] initWithString:label.text attributes:attributes];
```

è§‚å¯Ÿä¸€ä¸‹æ•ˆæœï¼Œå®Œç¾å¥‘åˆï¼ˆ~~å¯ä»¥åœ¨å°å§å§é¢å‰å¹ä¸€å¹´~~ï¼‰ï¼š

![26-F](/2018/03/26-F.png)

# å…³äºè¡Œé«˜ lineHeight

å¦‚æœä½ åªå…³å¿ƒ iOS è®¾å¤‡ä¸Šçš„æ–‡æœ¬å±•ç¤ºæ•ˆæœï¼Œé‚£ä¹ˆçœ‹åˆ°è¿™é‡Œå°±å·²ç»å¤Ÿäº†ã€‚ä½†æ˜¯æˆ‘éœ€è¦çš„æ˜¯ iOS å’Œ Android å±•ç°å‡ºä¸€æ¨¡ä¸€æ ·çš„æ•ˆæœï¼Œæ‰€ä»¥å…‰æœ‰è¡Œé—´è·æ˜¯ä¸èƒ½æ»¡è¶³éœ€æ±‚çš„ã€‚ä¸»è¦çš„åŸå› åœ¨å‰è¨€ä¹Ÿæåˆ°äº†ï¼ŒAndroid è®¾å¤‡ä¸Šçš„æ–‡å­—ä¸Šä¸‹é»˜è®¤ç•™ç™½ï¼ˆä¸Šä¸€èŠ‚å›¾ä¸­è“è‰²å’Œçº¢è‰²é‡å çš„éƒ¨åˆ†ï¼‰å’Œ iOS è®¾å¤‡ä¸Šçš„æ˜¯ä¸ä¸€è‡´çš„ï¼š

![26-G](/2018/03/26-G.png)

å·¦ä¾§æ˜¯ iOS è®¾å¤‡ï¼Œå³ä¾§ Android è®¾å¤‡ï¼Œå¯ä»¥çœ‹åˆ°åŒæ ·æ˜¯æ˜¾ç¤º 20 å·çš„å­—ä½“ï¼Œå®‰å“çš„è¡Œé«˜ä¼šåé«˜ä¸€äº›ã€‚åœ¨ä¸åŒçš„ Android è®¾å¤‡ä¸Šä½¿ç”¨çš„å­—ä½“ä¸ä¸€æ ·ï¼Œå¯èƒ½è¿˜ä¼šå‡ºç°æ›´å¤šçš„å·®åˆ«ã€‚å¦‚æœä¸æƒ³åŠæ³•æŠ¹å¹³è¿™å·®åˆ«ï¼Œå°±ä¸èƒ½çœŸæ­£æ„ä¹‰ä¸Šå®ç°åŒç«¯ä¸€è‡´äº†ã€‚

è¿™æ—¶å€™æˆ‘ä»¬å¯ä»¥é€šè¿‡è®¾ç½® lineHeight æ¥ä½¿å¾—æ¯ä¸€è¡Œæ–‡æœ¬çš„é«˜åº¦ä¸€è‡´ï¼ŒlineHeight è®¾ç½®ä¸º 30pt çš„æƒ…å†µä¸‹ï¼Œä¸€è¡Œæ–‡æœ¬é«˜åº¦ä¸€å®šæ˜¯ 30ptï¼Œä¸¤è¡Œæ–‡æœ¬é«˜åº¦ä¸€å®šæ˜¯ 60ptã€‚è™½ç„¶æ–‡å­—çš„æ¸²æŸ“ä¸Šä¼šæœ‰ç»†å¾®çš„å·®åˆ«ï¼Œä½†æ˜¯å¸ƒå±€ä¸Šçš„å·®åˆ«å°†è¢«å®Œå…¨çš„æŠ¹é™¤ã€‚lineHeight åŒæ ·å¯ä»¥å€ŸåŠ© NSAttributedString æ¥å®ç°ï¼Œç¤ºæ„ä»£ç ï¼š

```
NSMutableParagraphStyle *paragraphStyle = [NSMutableParagraphStyle new];
paragraphStyle.maximumLineHeight = lineHeight;
paragraphStyle.minimumLineHeight = lineHeight;
NSMutableDictionary *attributes = [NSMutableDictionary dictionary];
[attributes setObject:paragraphStyle forKey:NSParagraphStyleAttributeName];
label.attributedText = [[NSAttributedString alloc] initWithString:label.text attributes:attributes];
```

è¿è¡Œä¸€ä¸‹è§‚å¯Ÿæ•ˆæœï¼š

![27-A](/2018/03/27-A.png)

åœ¨ debug æ¨¡å¼ä¸‹ç¡®è®¤äº†ä¸‹æ–‡æœ¬çš„é«˜åº¦çš„ç¡®æ­£ç¡®çš„ï¼Œä½†æ˜¯ä¸ºä»€ä¹ˆæ–‡å­—éƒ½æ˜¾ç¤ºåœ¨äº†è¡Œåº•å‘¢ï¼Ÿ

# ä¿®æ­£è¡Œé«˜å¢åŠ åæ–‡å­—çš„ä½ç½®

ä¿®æ­£æ–‡å­—åœ¨è¡Œä¸­å±•ç¤ºçš„ä½ç½®ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ [baselineOffset](https://developer.apple.com/documentation/foundation/nsattributedstringkey/1526427-baselineoffset) å±æ€§æ¥æå®šã€‚è¿™ä¸ªå±æ€§ååˆ†æœ‰ç”¨ï¼Œåœ¨å®ç°ä¸Šæ ‡ä¸‹æ ‡ä¹‹ç±»çš„éœ€æ±‚æ—¶ä¹Ÿç»å¸¸ç”¨åˆ°å®ƒã€‚ç»è¿‡è°ƒè¯•ï¼Œå‘ç°æœ€åˆé€‚çš„å€¼æ˜¯ `(lineHeight - label.font.lineHeight) / 4`ï¼ˆå°šæœªææ¸…æ¥šä¸ºä»€ä¹ˆæ˜¯é™¤ä»¥ 4 è€Œä¸æ˜¯é™¤ä»¥ 2ï¼Œå¸Œæœ›çŸ¥é“çš„è€å¸æœºæŒ‡ç‚¹ä¸€äºŒï¼‰ã€‚æœ€ç»ˆçš„ä»£ç ç¤ºä¾‹å¦‚ä¸‹ï¼š

```
NSMutableParagraphStyle *paragraphStyle = [NSMutableParagraphStyle new];
paragraphStyle.maximumLineHeight = lineHeight;
paragraphStyle.minimumLineHeight = lineHeight;
NSMutableDictionary *attributes = [NSMutableDictionary dictionary];
[attributes setObject:paragraphStyle forKey:NSParagraphStyleAttributeName];
CGFloat baselineOffset = (lineHeight - label.font.lineHeight) / 4;
[attributes setObject:@(baselineOffset) forKey:NSBaselineOffsetAttributeName];
label.attributedText = [[NSAttributedString alloc] initWithString:label.text attributes:attributes];
```

è´´ä¸€ä¸‹åœ¨ä¸åŒå­—å·å’Œè¡Œé«˜ä¸‹çš„å±•ç¤ºæ•ˆæœï¼š

![27-B](/2018/03/27-B.png)

# è¡Œé«˜å’Œè¡Œé—´è·åŒæ—¶ä½¿ç”¨æ—¶çš„ä¸€ä¸ªé—®é¢˜

ä¸å¾—ä¸è¯´è¡Œé«˜å’Œè¡Œé—´è·æˆ‘ä»¬éƒ½å·²ç»å¯ä»¥å®Œç¾çš„å®ç°äº†ï¼Œä½†æ˜¯æˆ‘åœ¨å°è¯•åŒæ—¶ä½¿ç”¨å®ƒä»¬æ—¶ï¼Œå‘ç°äº† iOS çš„ä¸€ä¸ª bugï¼ˆå½“ç„¶ä¹Ÿå¯èƒ½æ˜¯ä¸€ä¸ª featureï¼Œæ¯•ç«Ÿä¸ crash éƒ½ä¸ä¸€å®šæ˜¯ bugï¼‰ï¼š

![27-C](/2018/03/27-C.png)

ç€è‰²çš„åŒºåŸŸéƒ½æ˜¯æ–‡æœ¬çš„ç»˜åˆ¶åŒºåŸŸï¼Œå…¶ä¸­çœ‹ä¸Šå»æ˜¯æ©™è‰²çš„åŒºåŸŸæ˜¯ lineSpacingï¼Œç»¿è‰²çš„åŒºåŸŸæ˜¯ lineHeightã€‚ä½†æ˜¯ä¸ºä»€ä¹ˆå•è¡Œçš„æ–‡æœ¬ç³»ç»Ÿä¹Ÿè¦å±•ç¤ºä¸€ä¸ª lineSpacing å•Šï¼ï¼Ÿå‘çˆ¹å‘¢è¿™æ˜¯ï¼ï¼Ÿ

å¥½åœ¨æˆ‘ä»¬é€šå¸¸æ˜¯è¡Œé«˜å’Œè¡Œé—´è·é’ˆå¯¹ä¸åŒçš„éœ€æ±‚åˆ†åˆ«ç‹¬ç«‹ä½¿ç”¨çš„ï¼Œå®ƒä»¬åœ¨åˆ†å¼€ä½¿ç”¨æ—¶ä¸ä¼šè§¦å‘è¿™ä¸ªé—®é¢˜ã€‚æ‰€ä»¥åœ¨ [VirtualView-iOS](https://github.com/alibaba/VirtualView-iOS) åº“ä¸­ï¼Œæˆ‘æš‚ä¸”å°†é«˜åº¦è®¡ç®—çš„é€»è¾‘ä¿æŒå’Œç³»ç»Ÿä¸€è‡´äº†ã€‚

# æ€»ç»“

è‡³æ­¤ï¼ŒæˆåŠŸçš„ä¸º [VirtualView-iOS](https://github.com/alibaba/VirtualView-iOS) æ·»åŠ äº†å¯¹ lineHeight å±æ€§çš„æ”¯æŒï¼Œæ›´å¤šçš„å®ç°ç»†èŠ‚å¤§å®¶å¯ä»¥åˆ°å¼€æºåº“ä¸­ç›´æ¥çœ‹æºä»£ç ã€‚å¸Œæœ›æˆ‘ä»¬çš„ Tangram æ–¹æ¡ˆå¯ä»¥æ›´åŠ å®Œå–„ï¼Œå¸®åŠ©æ›´å¤šçš„äººä¸€æ¬¡å¼€å‘ä¸¤ç«¯åŒæ—¶ä½¿ç”¨ï¼Œç”¨ä¸€å—ä¸ƒå·§æ¿æ‹¼å‡ºå¤§åƒä¸–ç•Œã€‚

æœ¬æ–‡é¦–å‘äº[è‹¹æœæ ¸åšå®¢](http://pingguohe.net/)ï¼Œä¹Ÿæ˜¯æˆ‘å†™çš„ä¸éœ€è¦æˆæƒğŸ˜ï¼Œä½†æ˜¯è¿™ä¸ªåšå®¢åå­—çœŸä¸æ˜¯æˆ‘èµ·çš„ğŸ™„ã€‚
