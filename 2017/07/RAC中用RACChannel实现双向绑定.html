<!DOCTYPE html><html lang="zh"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> RACä¸­ç”¨RACChannelå®ç°åŒå‘ç»‘å®š Â· è‹¹æœæ¢¨çš„åšå®¢</title><meta name="description" content="RACä¸­ç”¨RACChannelå®ç°åŒå‘ç»‘å®š - è‹¹æœæ¢¨"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="https://blog.harrisonxi.com/atom.xml" title="è‹¹æœæ¢¨çš„åšå®¢"><meta name="generator" content="Hexo 4.2.1"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">é¦–é¡µ</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">å½’æ¡£</a></li><li class="nav-list-item"><a href="/about.html" target="_self" class="nav-list-link">å…³äº</a></li><li class="nav-list-item"><a href="/links.html" target="_self" class="nav-list-link">å‹é“¾</a></li><li class="nav-list-item"><a href="https://github.com/HarrisonXi" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">RACä¸­ç”¨RACChannelå®ç°åŒå‘ç»‘å®š</h1><div class="post-info">2017-07-27<a href="/categories/iOS" class="post-category">iOS</a></div><div class="post-content"><h1 id="å°è¯•ç›´æ¥ç”¨RACSignalå®ç°åŒå‘ç»‘å®š"><a href="#å°è¯•ç›´æ¥ç”¨RACSignalå®ç°åŒå‘ç»‘å®š" class="headerlink" title="å°è¯•ç›´æ¥ç”¨RACSignalå®ç°åŒå‘ç»‘å®š"></a>å°è¯•ç›´æ¥ç”¨RACSignalå®ç°åŒå‘ç»‘å®š</h1><p>åœ¨æŸäº›åœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬éœ€è¦æŠŠä¸¤ä¸ªæ•°æ®ç›¸äº’ç»‘å®šï¼ŒAçš„æ”¹åŠ¨å½±å“Bï¼ŒBçš„æ”¹åŠ¨ä¹Ÿå½±å“Aã€‚</p>
<p>ä¸ºäº†è¡¨ç°ä¸Šå®¹æ˜“è§‚å¯Ÿï¼Œæˆ‘ä»¬å…ˆå‡è®¾æœ‰ä¸€ä¸ªåŒæ­¥ä¸¤ä¸ªæ–‡æœ¬æ¡†è¾“å…¥å†…å®¹çš„éœ€æ±‚ã€‚</p>
<a id="more"></a>

<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">RAC(<span class="keyword">self</span>.textFieldA, text) = <span class="keyword">self</span>.textFieldB.rac_textSignal;</span><br><span class="line">RAC(<span class="keyword">self</span>.textFieldB, text) = <span class="keyword">self</span>.textFieldA.rac_textSignal;</span><br></pre></td></tr></table></figure>

<p>å®ç°ä¸¤ä¸ªæ–‡æœ¬æ¡†ï¼Œç”¨ä¸Šé¢çš„ä»£ç ç›¸äº’ç»‘å®šï¼Œç„¶åè§‚çœ‹æ•ˆæœï¼š</p>
<p><img src="/2017/07/26-A.gif" alt="26-A"></p>
<p>å¯ä»¥çœ‹åˆ°æ‰€å¾—åˆ°çš„æ•ˆæœå’Œæˆ‘ä»¬æƒ³è¦çš„æ˜¯ä¸€è‡´çš„ã€‚ä½†æ˜¯è¿™åªæ˜¯ä¸€ä¸ªæ¯”è¾ƒå‡‘å·§çš„æ¡ˆä¾‹ï¼Œå› ä¸ºUITextFieldçš„<code>rac_textSignal</code>ç›‘è§†çš„å…¶å®æ˜¯UIäº‹ä»¶ï¼š</p>
<p><img src="/2017/07/26-B.png" alt="26-B"></p>
<p>åœ¨UITextFieldçš„<code>text</code>å±æ€§æ”¹å˜æ—¶ï¼Œä¸ä¼šè§¦å‘<code>rac_textSignal</code>ã€‚æ‰€ä»¥åœ¨A-&gt;Bçš„ä¿¡å·å½±å“äº†Bçš„<code>text</code>æ—¶ï¼Œä¸ä¼šè§¦å‘B-&gt;Açš„ä¿¡å·ã€‚</p>
<h1 id="å¯¹é€šå¸¸çš„æ•°æ®ç”¨RACSignalå®ç°åŒå‘ç»‘å®šä¼šå‡ºç°çš„é—®é¢˜"><a href="#å¯¹é€šå¸¸çš„æ•°æ®ç”¨RACSignalå®ç°åŒå‘ç»‘å®šä¼šå‡ºç°çš„é—®é¢˜" class="headerlink" title="å¯¹é€šå¸¸çš„æ•°æ®ç”¨RACSignalå®ç°åŒå‘ç»‘å®šä¼šå‡ºç°çš„é—®é¢˜"></a>å¯¹é€šå¸¸çš„æ•°æ®ç”¨RACSignalå®ç°åŒå‘ç»‘å®šä¼šå‡ºç°çš„é—®é¢˜</h1><p>è€Œå¯¹äºé€šå¸¸çš„æ•°æ®æ¥è¯´è¿›è¡ŒåŒå‘ç»‘å®šå°±ä¼šå‡ºé”™ï¼Œä»£ç å’Œé”™è¯¯ç›´æ¥ä¸€å›¾æµç”©å‡ºæ¥å…ˆï¼š</p>
<p><img src="/2017/07/26-C.png" alt="26-C"></p>
<p>çœ‹ä¸€çœ¼é”™è¯¯çš„æ ¹æºï¼š</p>
<p><img src="/2017/07/26-D.png" alt="26-D"></p>
<p>å¯ä»¥çœ‹åˆ°è¿™é‡Œå‡ºé”™çš„åŸå› å°±æ˜¯è°ƒç”¨å †æ ˆæº¢å‡ºäº†ã€‚å› ä¸ºåŒå‘ç»‘å®šå®Œæˆåï¼ŒAçš„æ”¹åŠ¨å½±å“äº†Bï¼Œç„¶åBçš„æ”¹åŠ¨åˆä¼šå½±å“Aï¼Œå½¢æˆäº†ä¸€ä¸ªä¿¡å·å¾ªç¯ï¼š</p>
<p><img src="/2017/07/26-F.png" alt="26-F"></p>
<p>æ‰“ç ´è¿™ä¸ªå¾ªç¯çš„æ–¹æ³•ä¹Ÿå¾ˆç®€å•ï¼Œåœ¨ä¿¡å·è®¢é˜…çš„blockä½“å†…è¿›è¡Œæ•°æ®æ”¹åŠ¨æ—¶ï¼Œæƒ³åŠæ³•ä¸å‘å‡ºä¿¡å·ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">@weakify(<span class="keyword">self</span>);</span><br><span class="line">[RACObserve(<span class="keyword">self</span>, a) subscribeNext:^(<span class="built_in">NSString</span> *x) &#123;</span><br><span class="line">    @strongify(<span class="keyword">self</span>);</span><br><span class="line">    <span class="keyword">self</span>-&gt;_b = x;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"A-&gt;B: %@"</span>, x);</span><br><span class="line">&#125;];</span><br><span class="line">[RACObserve(<span class="keyword">self</span>, b) subscribeNext:^(<span class="built_in">NSString</span> *x) &#123;</span><br><span class="line">    @strongify(<span class="keyword">self</span>);</span><br><span class="line">    <span class="keyword">self</span>-&gt;_a = x;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"B-&gt;A: %@"</span>, x);</span><br><span class="line">&#125;];</span><br></pre></td></tr></table></figure>

<p>åœ¨è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨æˆå‘˜å˜é‡å»ä¿®æ”¹Aå’ŒBå°±å¯ä»¥äº†ï¼Œå®Œç¾æå®šã€‚</p>
<p>ä½†æ˜¯è¿™ä¸æ˜¯ä¸‡èƒ½çš„ï¼Œå­˜åœ¨å¾ˆå¤šç¼ºé™·ï¼š</p>
<ol>
<li>æ²¡åŠæ³•ä½¿ç”¨<code>RAC(self, a) = RACObserve(self, b);</code>è¿™æ ·ä¼˜é›…çš„å†™æ³•äº†ã€‚</li>
<li>è®¿é—®ä¸åˆ°å†…éƒ¨æˆå‘˜å˜é‡çš„æ—¶å€™ï¼Œæ²¡æœ‰åŠæ³•è¿™æ ·å†™ã€‚</li>
<li>å¦‚æœä¸ºäº†è¿™ä¸ªéœ€æ±‚æ¥æš´éœ²å†…éƒ¨æˆå‘˜å˜é‡ï¼Œä¹Ÿæ˜¯å¾ˆä¸æ˜æ™ºçš„è¡Œä¸ºï¼Œä¼šç ´åViewModelçš„ç¨³å®šæ€§å’Œå°è£…æ€§ã€‚</li>
</ol>
<h1 id="RACChannelçš„å‡ºç°"><a href="#RACChannelçš„å‡ºç°" class="headerlink" title="RACChannelçš„å‡ºç°"></a>RACChannelçš„å‡ºç°</h1><p>åœ¨è¿™ä¸ªæ—¶å€™ï¼ŒRACChannelå°±éšéœ€è¦å‡ºç°äº†ã€‚</p>
<h2 id="RACChannelTerminalç®€ä»‹"><a href="#RACChannelTerminalç®€ä»‹" class="headerlink" title="RACChannelTerminalç®€ä»‹"></a>RACChannelTerminalç®€ä»‹</h2><p>å½“ç„¶çœ‹RACChannelè¦å…ˆçœ‹RACChannelTerminalï¼ŒRACChannelTerminalå®ƒæ˜¯ä¸€ä¸ªRACSignalåŒæ—¶ä¹Ÿæ˜¯ä¸€ä¸ªRACSubscriberï¼Œå°±æ˜¯è¯´å®ƒèƒ½å‘å‡ºä¿¡å·ä¹Ÿèƒ½è®¢é˜…ä¿¡å·ã€‚æˆ‘ä»¬ä¹‹åç§°å‘¼å®ƒä¸ºç»ˆç«¯ï¼Œå®ƒåœ¨åˆå§‹åŒ–çš„æ—¶å€™ä¼ å…¥äº†ä¸¤ä¸ªå€¼ï¼š</p>
<ol>
<li><code>values</code>ï¼šç»ˆç«¯è‡ªå·±å¯¹åº”çš„RACReplaySubjectï¼ˆä½œä¸ºRACSignalä½¿ç”¨ï¼‰ã€‚å¤–éƒ¨è®¢é˜…ç»ˆç«¯æ—¶è®¢é˜…çš„å®é™…ä¸Šæ˜¯<code>values</code>ã€‚</li>
<li><code>otherTerminal</code>ï¼šå¦ä¸€ä¸ªç»ˆç«¯å¯¹åº”çš„RACReplaySubjectï¼ˆä½œä¸ºRACSubscriberä½¿ç”¨ï¼‰ï¼Œç»ˆç«¯åœ¨è®¢é˜…å¤–éƒ¨ä¿¡å·åä¼šæŠŠæ”¶åˆ°çš„ä¿¡å·éƒ½è½¬å‘ç»™<code>otherTerminal</code>ã€‚</li>
</ol>
<h2 id="RACReplaySubjectç®€ä»‹"><a href="#RACReplaySubjectç®€ä»‹" class="headerlink" title="RACReplaySubjectç®€ä»‹"></a>RACReplaySubjectç®€ä»‹</h2><p>RACReplaySubjectæ˜¯ä¸€ç§ç‰¹æ®Šçš„RACSubjectï¼Œå®ƒå¯ä»¥å‘æ–°çš„è®¢é˜…è€…é‡æ–°å‘é€ä¸€éä¹‹å‰æ‰€å‘è¿‡çš„ä¿¡å·ã€‚åˆå§‹åŒ–RACReplaySubjectçš„æ—¶å€™ä¼šè¦æ±‚è®¾ç½®ä¸€ä¸ª<code>capacity</code>ï¼Œé»˜è®¤å€¼ä¸ºNSUIntegerMaxï¼ŒRACReplaySubjectä¼šreplayæœ€å¤š<code>capacity</code>ä¸ªå‘è¿‡çš„<code>next</code>ä¿¡å·ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œ<code>completed</code>å’Œ<code>error</code>ä¿¡å·æ˜¯å§‹ç»ˆä¼šreplayçš„ï¼Œå’Œ<code>capacity</code>è®¾ç½®çš„å¤§å°æ— å…³ã€‚</p>
<h2 id="RACChannelä»£ç è§£æ"><a href="#RACChannelä»£ç è§£æ" class="headerlink" title="RACChannelä»£ç è§£æ"></a>RACChannelä»£ç è§£æ</h2><p>æˆ‘ä»¬å›è¿‡å¤´æ¥çœ‹RACChannelçš„å®Œæ•´ä»£ç ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">RACChannel</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">instancetype</span>)init &#123;</span><br><span class="line">    <span class="keyword">self</span> = [<span class="keyword">super</span> init];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// We don't want any starting value from the leadingSubject, but we do want</span></span><br><span class="line">    <span class="comment">// error and completion to be replayed.</span></span><br><span class="line">    RACReplaySubject *leadingSubject = [[RACReplaySubject replaySubjectWithCapacity:<span class="number">0</span>] setNameWithFormat:<span class="string">@"leadingSubject"</span>];</span><br><span class="line">    RACReplaySubject *followingSubject = [[RACReplaySubject replaySubjectWithCapacity:<span class="number">1</span>] setNameWithFormat:<span class="string">@"followingSubject"</span>];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Propagate errors and completion to everything.</span></span><br><span class="line">    [[leadingSubject ignoreValues] subscribe:followingSubject];</span><br><span class="line">    [[followingSubject ignoreValues] subscribe:leadingSubject];</span><br><span class="line"></span><br><span class="line">    _leadingTerminal = [[[RACChannelTerminal alloc] initWithValues:leadingSubject otherTerminal:followingSubject] setNameWithFormat:<span class="string">@"leadingTerminal"</span>];</span><br><span class="line">    _followingTerminal = [[[RACChannelTerminal alloc] initWithValues:followingSubject otherTerminal:leadingSubject] setNameWithFormat:<span class="string">@"followingTerminal"</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>

<p>é¦–å…ˆRACChannelåˆ›å»ºäº†ä¸¤ä¸ªRACReplaySubjectï¼Œè¿™æ˜¯å†…éƒ¨çš„æ•°æ®é€šä¿¡ç®¡é“ä¸»è¦ç»„ä»¶ã€‚</p>
<p>å…¶ä¸­<code>followingSubject</code>çš„<code>capacity</code>ä¸º1ï¼Œè¡¨ç¤ºä¼šreplayæœ€åä¸€æ¬¡çš„ä¿¡å·ã€‚å› ä¸º<code>followingSubject</code>æ˜¯ä¾›å¤–éƒ¨è®¢é˜…ç”¨çš„ï¼Œæ‰€ä»¥é¦–æ¬¡è¢«è®¢é˜…æ—¶éœ€è¦ç»™å¤–éƒ¨ä¸€ä¸ªåˆå§‹å€¼ã€‚</p>
<p>ç„¶åè¿™ä¸¤ä¸ªRACReplaySubjectç›¸äº’ç›‘è§†äº†å¯¹æ–¹çš„<code>completed</code>å’Œ<code>error</code>ä¿¡å·ï¼ˆ<code>ignoreValues</code>ç”¨äºæ’é™¤<code>next</code>ä¿¡å·ï¼‰ï¼Œè¿™æ˜¯ä¸ºäº†ä¿è¯ä¸¤ä¸ªSubjectå§‹ç»ˆåŒæ­¥ï¼Œä¸ä¼šå…¶ä¸­ä¸€ä¸ªå·²ç»ç»ˆæ­¢äº†å¦ä¸€ä¸ªè¿˜åœ¨å·¥ä½œã€‚</p>
<p>æœ€ååˆ›å»ºäº†ä¸¤ä¸ªç»ˆç«¯å°†è¿™ä¸¤ä¸ªSubjectç›¸äº’ç»‘å®šï¼Œç»ˆç«¯æ‰€åšçš„å·¥ä½œå›¾ç¤ºå¦‚ä¸‹ï¼š</p>
<p><img src="/2017/07/27-A.png" alt="27-A"></p>
<p>æ€»ä½“çœ‹ä¸‹æ¥ï¼ŒRACChannelçš„è®¾è®¡æ€æƒ³ä¸Šå°±æ˜¯æä¾›ä¸¤ä¸ªç»ˆç«¯ï¼Œæ¯ä¸ªç»ˆç«¯å„æœ‰ä¸€ä¸ªè¾“å…¥å£å’Œä¸€ä¸ªè¾“å‡ºå£ï¼Œä¸€ä¸ªç»ˆç«¯è´Ÿè´£å’Œå†…éƒ¨æ•°æ®ç»‘å®šï¼Œä¸€ä¸ªç»ˆç«¯æš´éœ²å‡ºæ¥ä¾›å¤–éƒ¨æ•°æ®ç»‘å®šã€‚ä¸Šå›¾æŠŠå¤–éƒ¨è®¢é˜…è€…å’Œå¤–éƒ¨ä¿¡å·æºåˆ†å¼€æ¥å†™ï¼Œè¡¨ç¤ºå®ƒä»¬å¯èƒ½æ˜¯ä¸åŒçš„å¯¹è±¡ï¼Œå½“ç„¶å®ƒä»¬ä¹Ÿå¯ä»¥æ˜¯ç›¸åŒçš„å¯¹è±¡ï¼ˆå¦‚å¦ä¸€ä¸ªRACChannelçš„ç»ˆç«¯ï¼‰ã€‚ä¸€èˆ¬æ¥è¯´å°è£…å¥½çš„ä¾›ä½¿ç”¨çš„RACChannelä¼šå°†å…¶ä¸­ä¸€ä¸ªç»ˆç«¯åœ¨å†…éƒ¨å¤„ç†å¥½ï¼Œæš´éœ²å¦ä¸€ç«¯ä¾›ä½¿ç”¨è€…è¿›è¡Œè¾“å…¥å’Œè¾“å‡ºçš„ç»‘å®šã€‚</p>
<h2 id="RACChannelå°šéš¾ç›´æ¥ä½¿ç”¨"><a href="#RACChannelå°šéš¾ç›´æ¥ä½¿ç”¨" class="headerlink" title="RACChannelå°šéš¾ç›´æ¥ä½¿ç”¨"></a>RACChannelå°šéš¾ç›´æ¥ä½¿ç”¨</h2><p>è¿™ä¹ˆçœ‹ä¸‹æ¥ï¼Œæ˜¯ä¸æ˜¯åˆ›å»ºä¸ªRACChannelï¼ŒæŠŠå››ä¸ªå£ç»‘å®šå¥½å°±å¯ä»¥åŒå‘ä¼ è¾“æ•°æ®äº†ï¼Ÿè¯•ä¸€è¯•ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">RACChannel *channel = [RACChannel new];</span><br><span class="line">RAC(<span class="keyword">self</span>, a) = channel.leadingTerminal;</span><br><span class="line">[RACObserve(<span class="keyword">self</span>, a) subscribe:channel.leadingTerminal];</span><br><span class="line">RAC(<span class="keyword">self</span>, b) = channel.followingTerminal;</span><br><span class="line">[RACObserve(<span class="keyword">self</span>, b) subscribe:channel.followingTerminal];</span><br></pre></td></tr></table></figure>

<p>ç„¶åï¼Œä½ ä¼šå†æ¬¡å¾—åˆ°è°ƒç”¨å †æ ˆæº¢å‡ºçš„é”™è¯¯ã€‚ğŸ˜‚</p>
<p>å› ä¸ºRACChannelåªæ˜¯å®ç°äº†åŒå‘ç»‘å®šçš„è®¾è®¡æ€æƒ³ï¼Œå¹¶æ²¡æœ‰å¸®æˆ‘ä»¬å¤„ç†å¾ªç¯è°ƒç”¨çš„é—®é¢˜ã€‚æˆ‘ä»¬åœ¨ä½¿ç”¨RACChannelçš„æ—¶å€™ä¸€èˆ¬æ˜¯éœ€è¦ä½¿ç”¨å®ƒçš„å­ç±»ï¼Œæˆ–è€…è‡ªå·±è®¾è®¡å¥½ä»£ç åœ¨æŸæ¡ä¿¡å·é€šè·¯ä¸Šè¿›è¡Œæ‰“æ–­ã€‚</p>
<h1 id="RACKVOChannel"><a href="#RACKVOChannel" class="headerlink" title="RACKVOChannel"></a>RACKVOChannel</h1><p>çœ‹äº†é‚£ä¹ˆå¤šä»£ç å’ŒåŸç†ï¼Œæ˜¯æ—¶å€™æ™’ä¸€ä¸‹ç®€ä¾¿æ­£ç¡®çš„å†™æ³•æŒ¯å¥‹äººå¿ƒäº†ã€‚æƒ³è¦å®ç°Aå’ŒBåŒå‘ç»‘å®šï¼Œå…¶å®ä¸€å¥å°±å¯ä»¥ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">RACChannelTo(<span class="keyword">self</span>, a) = RACChannelTo(<span class="keyword">self</span>, b);</span><br></pre></td></tr></table></figure>

<p>è¿™å°±æ˜¯å‰æ–‡æåˆ°çš„åœ¨å†…éƒ¨å®ç°å¥½å¾ªç¯è°ƒç”¨ç»ˆæ­¢æ¡ä»¶çš„RACChanneläº†ã€‚</p>
<h2 id="RACChannelToçš„å±•å¼€"><a href="#RACChannelToçš„å±•å¼€" class="headerlink" title="RACChannelToçš„å±•å¼€"></a>RACChannelToçš„å±•å¼€</h2><p>æˆ‘ä»¬æŠŠ<code>RACChannelTo(self, a)</code>å…ˆå±•å¼€æ¥ï¼Œçœ‹ä¸€ä¸‹å®ƒåˆ°åº•åšäº†ä»€ä¹ˆï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[[RACKVOChannel alloc] initWithTarget:<span class="keyword">self</span> keyPath:<span class="string">@"a"</span> nilValue:<span class="literal">nil</span>][<span class="string">@"followingTerminal"</span>]</span><br></pre></td></tr></table></figure>

<p>æ‰€ä»¥è¯´ï¼Œä¸Šé¢å®ç°åŒå‘ç»‘å®šçš„è¯­å¥å±•å¼€æ¥ï¼Œå®é™…ä¸Šåšäº†ä¸¤ä»¶äº‹ï¼š</p>
<ol>
<li>ä¸ºAå’ŒBåˆ†åˆ«åˆ›å»ºäº†<code>channelA</code>å’Œ<code>channelB</code>ã€‚</li>
<li>è°ƒç”¨<code>channelA[@&quot;followingTerminal&quot;] = channelB[@&quot;followingTerminal&quot;]</code>ã€‚</li>
</ol>
<p>å¦‚æœä½ å¯¹å®å®šä¹‰å±•å¼€çš„ç»†èŠ‚æ„Ÿå…´è¶£ï¼Œæˆ‘è§‰å¾—Sunnyå¤§å¤§çš„<a href="http://blog.sunnyxx.com/2014/03/06/rac_1_macros/" target="_blank" rel="noopener">è¿™ç¯‡åšå®¢</a>å¯ä»¥å¸®åˆ°ä½ ã€‚</p>
<h2 id="RACKVOChannelå¦‚ä½•å®ç°åŒå‘ç»‘å®š"><a href="#RACKVOChannelå¦‚ä½•å®ç°åŒå‘ç»‘å®š" class="headerlink" title="RACKVOChannelå¦‚ä½•å®ç°åŒå‘ç»‘å®š"></a>RACKVOChannelå¦‚ä½•å®ç°åŒå‘ç»‘å®š</h2><p>æˆ‘ä»¬çœ‹ä¸€ä¸‹è¿™æ®µä»£ç ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">RACKVOChannel</span> (<span class="title">RACChannelTo</span>)</span></span><br><span class="line"></span><br><span class="line">- (RACChannelTerminal *)objectForKeyedSubscript:(<span class="built_in">NSString</span> *)key &#123;</span><br><span class="line">    <span class="built_in">NSCParameterAssert</span>(key != <span class="literal">nil</span>);</span><br><span class="line"></span><br><span class="line">    RACChannelTerminal *terminal = [<span class="keyword">self</span> valueForKey:key];</span><br><span class="line">    <span class="built_in">NSCAssert</span>([terminal isKindOfClass:RACChannelTerminal.class], <span class="string">@"Key \"%@\" does not identify a channel terminal"</span>, key);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> terminal;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)setObject:(RACChannelTerminal *)otherTerminal forKeyedSubscript:(<span class="built_in">NSString</span> *)key &#123;</span><br><span class="line">    <span class="built_in">NSCParameterAssert</span>(otherTerminal != <span class="literal">nil</span>);</span><br><span class="line"></span><br><span class="line">    RACChannelTerminal *selfTerminal = [<span class="keyword">self</span> objectForKeyedSubscript:key];</span><br><span class="line">    [otherTerminal subscribe:selfTerminal];</span><br><span class="line">    [[selfTerminal skip:<span class="number">1</span>] subscribe:otherTerminal];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>

<p><code>objectForKeyedSubscript:</code>æä¾›äº†é€šè¿‡é”®<code>@â€œfollowingTerminalâ€</code>è¯»å–ç»ˆç«¯çš„èƒ½åŠ›ï¼Œ<code>setObject:forKeyedSubscript:</code>æä¾›äº†é€šè¿‡é”®<code>@â€œfollowingTerminalâ€</code>è®¾å®šå’Œç»‘å®šç»ˆç«¯çš„èƒ½åŠ›ã€‚</p>
<p>ç»‘å®šçš„æ“ä½œå…¶å®å°±æ˜¯å°†ä¸¤ä¸ª<code>followingTerminal</code>ç›¸äº’è®¢é˜…ã€‚æ³¨æ„å› ä¸ºä¸¤ç«¯æ•°æ®æ˜¯åŒæ­¥çš„ï¼Œæ‰€ä»¥åœ¨æ­£å‘è®¢é˜…åä¸¤ç«¯çš„å€¼åº”è¯¥ä¸€æ ·äº†ï¼Œæ‰€ä»¥åœ¨åå‘ç»‘å®šçš„æ—¶å€™å°±å¯ä»¥<code>skip:1</code>æ¥èŠ‚çº¦ç‚¹æ€§èƒ½äº†ã€‚</p>
<h2 id="RACKVOChannelåœ¨å“ªé‡Œæ‰“æ–­äº†ä¿¡å·é€šé“çš„å¾ªç¯è°ƒç”¨"><a href="#RACKVOChannelåœ¨å“ªé‡Œæ‰“æ–­äº†ä¿¡å·é€šé“çš„å¾ªç¯è°ƒç”¨" class="headerlink" title="RACKVOChannelåœ¨å“ªé‡Œæ‰“æ–­äº†ä¿¡å·é€šé“çš„å¾ªç¯è°ƒç”¨"></a>RACKVOChannelåœ¨å“ªé‡Œæ‰“æ–­äº†ä¿¡å·é€šé“çš„å¾ªç¯è°ƒç”¨</h2><p>å¯ä»¥çœ‹åˆ°è¿™æ®µä»£ç é¦–å…ˆåˆ›å»ºäº†ä¸€ä¸ªRACKVOChannelï¼ŒRACKVOChannelé‡Œä¸»è¦åšçš„ä¸¤ä»¶äº‹å°±æ˜¯<code>leadingTerminal</code>çš„<code>sendNext</code>å’Œ<code>leadingTerminal</code>å’Œ<code>subscribeNext</code>ï¼Œè¿™ä¸ªä»å‰é¢ä¸€ç‚¹ç‚¹è¯»ä¸‹æ¥çš„è¯»è€…åº”è¯¥éƒ½èƒ½æ˜ç™½ï¼Œæ˜¯å°†ç›®æ ‡çš„æŒ‡å®šå±æ€§å’ŒRACKVOChannelçš„<code>leadingTerminal</code>åšå¥½ç»‘å®šã€‚</p>
<p>æˆ‘ä»¬ä¸»è¦å…³æ³¨çš„æ˜¯ï¼ŒRACKVOChannelåœ¨å“ªé‡Œæ‰“æ–­äº†ä¿¡å·é€šé“çš„å¾ªç¯è°ƒç”¨ã€‚å…ˆçœ‹<code>subscribeNext</code>æ®µé‡Œè¿™ä¸€éƒ¨åˆ†ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Set the ignoreNextUpdate flag before setting the value so this channel</span></span><br><span class="line"><span class="comment">// ignores the value in the subsequent -didChangeValueForKey: callback.</span></span><br><span class="line">[<span class="keyword">self</span> createCurrentThreadData];</span><br><span class="line"><span class="keyword">self</span>.currentThreadData.ignoreNextUpdate = <span class="literal">YES</span>;</span><br></pre></td></tr></table></figure>

<p>æ³¨é‡Šå†™å¾—æ¯”è¾ƒæ¸…æ¥šï¼Œè¿™ä¸ª<code>ignoreNextUpdate</code>ä½¿å¾—ä¸‹ä¸€æ¬¡çš„å€¼ä¿®æ”¹è¢«å¿½ç•¥ã€‚å…·ä½“çš„å¿½ç•¥ä»£ç åœ¨<code>sendNext</code>æ®µï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// If the change wasn't triggered by deallocation, only affects the last</span></span><br><span class="line"><span class="comment">// path component, and ignoreNextUpdate is set, then it was triggered by</span></span><br><span class="line"><span class="comment">// this channel and should not be forwarded.</span></span><br><span class="line"><span class="keyword">if</span> (!causedByDealloc &amp;&amp; affectedOnlyLastComponent &amp;&amp; <span class="keyword">self</span>.currentThreadData.ignoreNextUpdate) &#123;</span><br><span class="line">    [<span class="keyword">self</span> destroyCurrentThreadData];</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨<code>ignoreNextUpdate</code>ä¸ºYESçš„æ—¶å€™ï¼Œè¿™é‡Œå°±ä¼šreturnå‡ºå»ï¼Œä¸ä¼šè§¦å‘<code>sendNext</code>æ“ä½œã€‚</p>
<p>ç”¨å›¾ç‰‡æ ‡è®°çš„ç›´è§‚ç‚¹ï¼Œå°±æ˜¯å¦‚æœæ˜¯åœ¨<code>leadingTerminal</code>çš„<code>subscribeNext</code>é‡Œä¿®æ”¹äº†ç›®æ ‡çš„å±æ€§å€¼ï¼Œé€šè·¯ä¼šåœ¨æ­¤æ‰“æ–­ï¼Œä¸ä¼šé‡å¤çš„å†æŠŠå±æ€§å€æ”¹å˜çš„ä¿¡å·<code>sendNext</code>å‡ºå»ï¼š</p>
<p><img src="/2017/07/27-B.png" alt="27-B"></p>
<h2 id="RACChannelToæ€»ç»“"><a href="#RACChannelToæ€»ç»“" class="headerlink" title="RACChannelToæ€»ç»“"></a>RACChannelToæ€»ç»“</h2><p>æ€»ä¹‹è¿›è¡Œé€šå¸¸æ•°æ®çš„åŒå‘ç»‘å®šï¼ŒRACChannelToåŸºæœ¬å°±æ˜¯æ— æ•Œçš„ï¼Œå‡ ä¹å¯ä»¥å®Œæˆç»å¤§éƒ¨åˆ†éœ€æ±‚äº†ã€‚</p>
<h1 id="å…¶ä»–å¸¸è§çš„RACChannelç›¸å…³çš„ç±»æ‰©å±•"><a href="#å…¶ä»–å¸¸è§çš„RACChannelç›¸å…³çš„ç±»æ‰©å±•" class="headerlink" title="å…¶ä»–å¸¸è§çš„RACChannelç›¸å…³çš„ç±»æ‰©å±•"></a>å…¶ä»–å¸¸è§çš„RACChannelç›¸å…³çš„ç±»æ‰©å±•</h1><p>RACåº“å¯¹å¸¸ç”¨çš„ç»„ä»¶éƒ½è¿›è¡Œäº†æ‰©å±•æ–¹ä¾¿æˆ‘ä»¬ä½¿ç”¨ï¼Œä¸‹é¢ä¸¾å‡ ä¸ªä¾‹å­ã€‚</p>
<h2 id="NSUserDefaults-RACSupport"><a href="#NSUserDefaults-RACSupport" class="headerlink" title="NSUserDefaults (RACSupport)"></a>NSUserDefaults (RACSupport)</h2><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">- (RACChannelTerminal *)rac_channelTerminalForKey:(<span class="built_in">NSString</span> *)key;</span><br></pre></td></tr></table></figure>

<p>ä¸ºæŒ‡å®šçš„<code>key</code>åˆ›å»ºä¸€ä¸ªåŒå‘ç»‘å®šç”¨çš„RACChannelï¼Œåœ¨å†…éƒ¨å’ŒRACKVOChannelåšäº†åŒæ ·çš„åˆ‡æ–­å¾ªç¯æ“ä½œã€‚æ³¨æ„è¿™é‡Œè¿”å›çš„æ˜¯<code>followingTerminal</code>ã€‚</p>
<h2 id="UITextField-RACSignalSupport"><a href="#UITextField-RACSignalSupport" class="headerlink" title="UITextField (RACSignalSupport)"></a>UITextField (RACSignalSupport)</h2><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">- (RACChannelTerminal&lt;<span class="built_in">NSString</span> *&gt; *)rac_newTextChannel;</span><br></pre></td></tr></table></figure>

<p>ä¸ºæ–‡æœ¬çš„å˜æ›´åˆ›å»ºä¸€ä¸ªåŒå‘ç»‘å®šç”¨çš„RACChannelï¼Œå› ä¸ºæœ¬æ–‡æœ€å‰é¢æåˆ°çš„åŸå› ï¼Œæ–‡æœ¬å˜æ›´ä¿¡å·æ˜¯ä»UIäº‹ä»¶è§¦å‘çš„ï¼Œæ¥å—æ–°çš„æ–‡æœ¬æ˜¯è®¾ç½®åˆ°<code>text</code>å±æ€§çš„ï¼Œæ‰€ä»¥ä¸¤è€…ç›¸äº’ç‹¬ç«‹æœ¬æ¥å°±ä¸ä¼šå¾ªç¯è°ƒç”¨ã€‚å¦å¤–æ³¨æ„è¿™é‡Œè¿”å›çš„æ˜¯<code>leadingTerminal</code>ï¼Œä½¿ç”¨ä¸Šè¦ç‰¹åˆ«æ³¨æ„çš„æ˜¯åˆæ¬¡ç»‘å®šçš„æ—¶å€™ä¸ä¼šè§¦å‘ä¸€æ¬¡åˆå§‹åŒ–ä¿¡å·ï¼Œè¿™æ ·æ­£å¥½å¯ä»¥æ–¹ä¾¿é…åˆåˆ«çš„<code>followingTerminal</code>ä½¿ç”¨è€Œä¸éœ€è¦è¿›è¡Œ<code>skip:1</code>ã€‚</p>
<p>å…¶å®ƒçš„UIæ§ä»¶çš„RACChannelæ‰©å±•å’ŒUITextFieldéƒ½ç±»ä¼¼ã€‚</p>
<h2 id="åˆå¹¶ä½¿ç”¨çš„ç¤ºä¾‹"><a href="#åˆå¹¶ä½¿ç”¨çš„ç¤ºä¾‹" class="headerlink" title="åˆå¹¶ä½¿ç”¨çš„ç¤ºä¾‹"></a>åˆå¹¶ä½¿ç”¨çš„ç¤ºä¾‹</h2><p>è¿™é‡Œæ˜¯ä¸€ä¸ªå’ŒViewModelè¿›è¡Œç»‘å®šçš„ä¾‹å­ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¦‚æœä»…éœ€è¦å•å‘ç»‘å®šï¼Œä½¿ç”¨rac_textSignal</span></span><br><span class="line"><span class="comment">// RAC(self.viewModel, username) = self.usernameTextField.rac_textSignal;</span></span><br><span class="line"><span class="comment">// å¦‚æœéœ€è¦åŒå‘ç»‘å®šï¼Œåˆ™ä½¿ç”¨rac_newTextChannel</span></span><br><span class="line">RACChannelTo(<span class="keyword">self</span>.viewModel, username) = <span class="keyword">self</span>.usernameTextField.rac_newTextChannel;</span><br></pre></td></tr></table></figure>

<p>éœ€è¦æ³¨æ„çš„ä¸€ç‚¹æ˜¯ï¼Œæ¯ä¸€æ¬¡è°ƒç”¨<code>rac_newTextChannel</code>éƒ½æ˜¯åˆ›å»ºä¸€ä¸ªæ–°çš„RACChannelï¼Œå¦‚æœéœ€è¦è¿›è¡Œå¤šæ¬¡é‡å¤ä½¿ç”¨ï¼Œè¯·è‡ªè¡ŒæŠŠè·å¾—çš„RACChannelTerminalä¿å­˜ä¸‹æ¥ã€‚</p>
<p>å¦‚æœæ˜¯NSUserDefaultså’ŒUITextFieldåŒå‘ç»‘å®šï¼Œå¯ä»¥æ‰‹åŠ¨å†™ä¸€ä¸‹è®¢é˜…ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">RACChannelTerminal *userDefaultsTerminal = [[<span class="built_in">NSUserDefaults</span> standardUserDefaults] rac_channelTerminalForKey:<span class="string">@"username"</span>];</span><br><span class="line">RACChannelTerminal *textfieldTerminal = <span class="keyword">self</span>.usernameTextField.rac_newTextChannel;</span><br><span class="line">[textfieldTerminal subscribe:userDefaultsTerminal];</span><br><span class="line">[userDefaultsTerminal subscribe:textfieldTerminal];</span><br></pre></td></tr></table></figure>

<h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>ä¸å¾—ä¸è¯´RACçš„ä½œè€…å¤§ç¥ä»¬ä¼Ÿå¤§ä¹‹æï¼Œå½“ä¹‹æ— æ„§çš„ObjCæ–°çºªå…ƒå¼€åˆ›è€…ã€‚RACChannelæ€è·¯ç®€å•ä½†æ˜¯å®ç°èµ·æ¥çœŸçš„ä¸ç®€å•ï¼Œé˜…è¯»ä»£ç æ…¢æ…¢ç†è§£RACçš„ç²¾åå®åœ¨æ˜¯ä¸€ç§æ„‰æ‚¦ï½</p>
</div></article></div></main><footer><div class="paginator"><a href="/2017/09/RAC%E4%B8%AD%E7%94%A8RACCommand%E5%A4%84%E7%90%86%E6%8C%87%E4%BB%A4.html" class="prev">ä¸Šä¸€ç¯‡</a><a href="/2017/07/iOS%E4%BD%BF%E7%94%A8RAC%E5%AE%9E%E7%8E%B0MVVM%E7%9A%84%E6%AD%A3%E7%BB%8F%E5%A7%BF%E5%8A%BF.html" class="next">ä¸‹ä¸€ç¯‡</a></div><div id="disqus_thread"></div><script>var disqus_shortname = 'ping-guo-li-de-bo-ke';
var disqus_identifier = '2017/07/RACä¸­ç”¨RACChannelå®ç°åŒå‘ç»‘å®š.html';
var disqus_title = 'RACä¸­ç”¨RACChannelå®ç°åŒå‘ç»‘å®š';
var disqus_url = 'https://blog.harrisonxi.com/2017/07/RACä¸­ç”¨RACChannelå®ç°åŒå‘ç»‘å®š.html';
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//ping-guo-li-de-bo-ke.disqus.com/count.js" async></script><div class="copyright"><p>Â© 2017 - 2024 <a href="https://blog.harrisonxi.com">è‹¹æœæ¢¨</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-110376743-1",'auto');ga('send','pageview');</script></body></html>