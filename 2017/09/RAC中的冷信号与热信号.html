<!DOCTYPE html><html lang="zh"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> RAC中的冷信号与热信号 · 苹果梨的博客</title><meta name="description" content="RAC中的冷信号与热信号 - 苹果梨"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="https://blog.harrisonxi.com/atom.xml" title="苹果梨的博客"><meta name="generator" content="Hexo 4.2.1"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">首页</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">归档</a></li><li class="nav-list-item"><a href="/about.html" target="_self" class="nav-list-link">关于</a></li><li class="nav-list-item"><a href="/links.html" target="_self" class="nav-list-link">友链</a></li><li class="nav-list-item"><a href="https://github.com/HarrisonXi" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">RAC中的冷信号与热信号</h1><div class="post-info">2017-09-21<a href="/categories/iOS" class="post-category">iOS</a></div><div class="post-content"><h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>本文主旨是浅显易懂的讲解下冷热信号的区别和常见的使用误区，所以篇幅所限不会介绍些内部细节。</p>
<p>如果想要了解的更深入，可以参照William Zang的博文：<a href="http://williamzang.com/blog/2015/08/18/talk-about-reactivecocoas-cold-signal-and-hot-signal/" target="_blank" rel="noopener">细说ReactiveCocoa的冷信号与热信号</a>。</p>
<p>文中部分内容参考RAC 4.x的文档：<a href="https://github.com/ReactiveCocoa/ReactiveCocoa/blob/v4.2.2/Documentation/DesignGuidelines.md#the-signal-contract" target="_blank" rel="noopener">设计指南</a>、<a href="https://github.com/ReactiveCocoa/ReactiveCocoa/blob/v4.2.2/Documentation/FrameworkOverview.md" target="_blank" rel="noopener">框架概览</a>，但是文章本身是介绍ObjC的RAC 2.5。</p>
<p>另外和前一篇博文一样，我称呼一组信号叫做<strong>信号流</strong>，单次发送的信号值为<strong>信号</strong>。</p>
<a id="more"></a>

<h1 id="热信号流"><a href="#热信号流" class="headerlink" title="热信号流"></a>热信号流</h1><p>热信号流在RAC 3.x以后为Signal，在RAC 2.5中对应RACSubject。</p>
<h2 id="特征"><a href="#特征" class="headerlink" title="特征"></a>特征</h2><p>所谓热信号流是用来观察一组随时间流逝的事件用的。一般来说它被用作观察执行中（in progress）事件的进度或流程，例如下载事件的进度和流程。</p>
<p>热信号流有以下特征：</p>
<ol>
<li>随信号发出者自己的进度发送信号，创建后即开始工作。</li>
<li>新增观察者对信号流不产生任何<a href="https://zh.wikipedia.org/wiki/%E5%87%BD%E6%95%B0%E5%89%AF%E4%BD%9C%E7%94%A8" target="_blank" rel="noopener">副作用</a>，无论有没有观察者这个信号流都做相同的工作。</li>
<li>所有观察者都会在同样的时间收到同样的信号。</li>
</ol>
<h2 id="例子"><a href="#例子" class="headerlink" title="例子"></a>例子</h2><p>举个例子，蒸包子大师傅一天的工作就可以成为一个热信号流，而围观大师傅蒸包子的人就是观察者：</p>
<ol>
<li>每半小时出笼一次包子，算作发送一次信号。大师傅兢兢业业，早上上班后就开始一直蒸包子。</li>
<li>有人来围观大师傅蒸包子对大师傅不产生影响，无论有多少人围观大师傅，大师傅都是半小时出笼一次。</li>
<li>每隔半小时，正在围观的人都能同时看到大师傅出笼一次包子。错过的人就看不到这次的出笼事件。</li>
</ol>
<p>可以说，这里的围观者更关注的是大师傅什么时候出笼包子这类事件。</p>
<h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><p>注意我们先在RACSubject.m里加上一段NSLog来记录发出的事件：</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)sendNext:(<span class="keyword">id</span>)value &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"RACSubject sendNext: %@"</span>, value);</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后写代码模仿上面的例子：</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"create RACSubject"</span>);</span><br><span class="line"></span><br><span class="line">RACSubject *subject = [RACSubject subject];</span><br><span class="line">[subject sendNext:<span class="string">@"大师傅上班"</span>];</span><br><span class="line">[[RACScheduler mainThreadScheduler] afterDelay:<span class="number">1.0</span> schedule:^&#123;</span><br><span class="line">    [subject sendNext:<span class="string">@"第一次出笼"</span>];</span><br><span class="line">&#125;];</span><br><span class="line">[[RACScheduler mainThreadScheduler] afterDelay:<span class="number">2.0</span> schedule:^&#123;</span><br><span class="line">    [subject sendNext:<span class="string">@"第二次出笼"</span>];</span><br><span class="line">&#125;];</span><br><span class="line"></span><br><span class="line">[[RACScheduler mainThreadScheduler] afterDelay:<span class="number">0.5</span> schedule:^&#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"路人甲开始围观"</span>);</span><br><span class="line">    [subject subscribeNext:^(<span class="built_in">NSString</span> *msg) &#123;</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"路人甲看到%@"</span>, msg);</span><br><span class="line">    &#125;];</span><br><span class="line">&#125;];</span><br><span class="line"></span><br><span class="line">[[RACScheduler mainThreadScheduler] afterDelay:<span class="number">1.5</span> schedule:^&#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"路人乙开始围观"</span>);</span><br><span class="line">    [subject subscribeNext:^(<span class="built_in">NSString</span> *msg) &#123;</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"路人乙看到%@"</span>, msg);</span><br><span class="line">    &#125;];</span><br><span class="line">&#125;];</span><br></pre></td></tr></table></figure>

<p>观察日志：</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2017</span><span class="number">-09</span><span class="number">-21</span> <span class="number">15</span>:<span class="number">26</span>:<span class="number">52.657</span> MvvmDemo[<span class="number">1246</span>:<span class="number">146676</span>] create RACSubject</span><br><span class="line"><span class="number">2017</span><span class="number">-09</span><span class="number">-21</span> <span class="number">15</span>:<span class="number">26</span>:<span class="number">52.658</span> MvvmDemo[<span class="number">1246</span>:<span class="number">146676</span>] RACSubject sendNext: 大师傅上班</span><br><span class="line"><span class="number">2017</span><span class="number">-09</span><span class="number">-21</span> <span class="number">15</span>:<span class="number">26</span>:<span class="number">53.203</span> MvvmDemo[<span class="number">1246</span>:<span class="number">146676</span>] 路人甲开始围观</span><br><span class="line"><span class="number">2017</span><span class="number">-09</span><span class="number">-21</span> <span class="number">15</span>:<span class="number">26</span>:<span class="number">53.658</span> MvvmDemo[<span class="number">1246</span>:<span class="number">146676</span>] RACSubject sendNext: 第一次出笼</span><br><span class="line"><span class="number">2017</span><span class="number">-09</span><span class="number">-21</span> <span class="number">15</span>:<span class="number">26</span>:<span class="number">53.659</span> MvvmDemo[<span class="number">1246</span>:<span class="number">146676</span>] 路人甲看到第一次出笼</span><br><span class="line"><span class="number">2017</span><span class="number">-09</span><span class="number">-21</span> <span class="number">15</span>:<span class="number">26</span>:<span class="number">54.308</span> MvvmDemo[<span class="number">1246</span>:<span class="number">146676</span>] 路人乙开始围观</span><br><span class="line"><span class="number">2017</span><span class="number">-09</span><span class="number">-21</span> <span class="number">15</span>:<span class="number">26</span>:<span class="number">54.856</span> MvvmDemo[<span class="number">1246</span>:<span class="number">146676</span>] RACSubject sendNext: 第二次出笼</span><br><span class="line"><span class="number">2017</span><span class="number">-09</span><span class="number">-21</span> <span class="number">15</span>:<span class="number">26</span>:<span class="number">54.856</span> MvvmDemo[<span class="number">1246</span>:<span class="number">146676</span>] 路人甲看到第二次出笼</span><br><span class="line"><span class="number">2017</span><span class="number">-09</span><span class="number">-21</span> <span class="number">15</span>:<span class="number">26</span>:<span class="number">54.857</span> MvvmDemo[<span class="number">1246</span>:<span class="number">146676</span>] 路人乙看到第二次出笼</span><br></pre></td></tr></table></figure>

<p>可以看到这完美的诠释了以上热信号流的各种特征。</p>
<h1 id="冷信号流"><a href="#冷信号流" class="headerlink" title="冷信号流"></a>冷信号流</h1><p>冷信号流在RAC 3.x以后叫做Signal Producers，在RAC 2.5中对应RACSignal。</p>
<p>注意RACSubject是RACSignal的一个子类，这也是RAC中大家常搞不清冷热信号流的一个重要原因。😂</p>
<h2 id="特征-1"><a href="#特征-1" class="headerlink" title="特征"></a>特征</h2><p>所谓冷信号流是创建一组信号和处理副作用的。它的主要作用是处理一组完整的操作或任务，供用户观察事件<strong>从开始到结束</strong>的整个流程和事件的<strong>结果</strong>。例如处理一整段网络请求相关操作，供用户观察请求的结果是什么。</p>
<p>冷信号流有以下特征：</p>
<ol>
<li>创建时并不立刻开始工作，在被订阅的时候才开始工作。就是说订阅操作本身会对信号流产生作用。</li>
<li>每个新增的订阅者收到的可能都是不同的，分别独立的信号流。这些信号流的结果也可能不同，因为冷信号流可能包含一些<a href="https://zh.wikipedia.org/wiki/函数副作用" target="_blank" rel="noopener">副作用</a>。</li>
</ol>
<h2 id="例子-1"><a href="#例子-1" class="headerlink" title="例子"></a>例子</h2><p>举个例子，包子店收银员卖出包子的过程就可以作为一个冷信号流，而每个买包子的顾客就是一个订阅者：</p>
<ol>
<li>收银员上班的时候不是立刻就有工作，在一个新的顾客来的时候才会进行卖包子的工作。</li>
<li>每个顾客买到的包子都是不同的包子（即使馅一样，也是不同的实例）。而因为还有找不开钱，包子卖完了等各种副作用存在，有可能顾客还会买不到包子。</li>
</ol>
<h2 id="代码-1"><a href="#代码-1" class="headerlink" title="代码"></a>代码</h2><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"create RACSignal"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="built_in">NSInteger</span> count = <span class="number">2</span>;</span><br><span class="line">RACSignal *signal = [RACSignal createSignal:^RACDisposable * _Nullable(<span class="keyword">id</span>&lt;RACSubscriber&gt;  _Nonnull subscriber) &#123;</span><br><span class="line">    <span class="keyword">if</span> (count &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        [subscriber sendNext:<span class="string">@"给收银员钱"</span>];</span><br><span class="line">        [subscriber sendNext:<span class="string">@"买到包子"</span>];</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        [subscriber sendNext:<span class="string">@"没买到包子"</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    count--;</span><br><span class="line">    [subscriber sendCompleted];</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">&#125;];</span><br><span class="line"></span><br><span class="line">[[RACScheduler mainThreadScheduler] afterDelay:<span class="number">1.0</span> schedule:^&#123;</span><br><span class="line">    [signal subscribeNext:^(<span class="built_in">NSString</span> *msg) &#123;</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"顾客甲%@"</span>, msg);</span><br><span class="line">    &#125;];</span><br><span class="line">&#125;];</span><br><span class="line"></span><br><span class="line">[[RACScheduler mainThreadScheduler] afterDelay:<span class="number">2.0</span> schedule:^&#123;</span><br><span class="line">    [signal subscribeNext:^(<span class="built_in">NSString</span> *msg) &#123;</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"顾客乙%@"</span>, msg);</span><br><span class="line">    &#125;];</span><br><span class="line">&#125;];</span><br><span class="line"></span><br><span class="line">[[RACScheduler mainThreadScheduler] afterDelay:<span class="number">3.0</span> schedule:^&#123;</span><br><span class="line">    [signal subscribeNext:^(<span class="built_in">NSString</span> *msg) &#123;</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"顾客丙%@"</span>, msg);</span><br><span class="line">    &#125;];</span><br><span class="line">&#125;];</span><br></pre></td></tr></table></figure>

<p>注意，这里我们用<code>count</code>模拟了一个剩余包子数量的外部值作为<a href="https://zh.wikipedia.org/wiki/函数副作用" target="_blank" rel="noopener">副作用</a>。但是这里没有做多线程保护，各位自己写代码的时候一定要记得做好对应的多线程保护。</p>
<p>另外要加个NSLog，RACSignal发送信号其实最终是在RACPassthroughSubscriber.m里做的：</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)sendNext:(<span class="keyword">id</span>)value &#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"RACSignal sendNext: %@"</span>, value);</span><br><span class="line">    [<span class="keyword">self</span>.innerSubscriber sendNext:value];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>观察日志：</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2017</span><span class="number">-09</span><span class="number">-21</span> <span class="number">17</span>:<span class="number">09</span>:<span class="number">06.349</span> MvvmDemo[<span class="number">1494</span>:<span class="number">203071</span>] create RACSignal</span><br><span class="line"><span class="number">2017</span><span class="number">-09</span><span class="number">-21</span> <span class="number">17</span>:<span class="number">09</span>:<span class="number">07.351</span> MvvmDemo[<span class="number">1494</span>:<span class="number">203071</span>] RACSignal sendNext: 给收银员钱</span><br><span class="line"><span class="number">2017</span><span class="number">-09</span><span class="number">-21</span> <span class="number">17</span>:<span class="number">09</span>:<span class="number">07.351</span> MvvmDemo[<span class="number">1494</span>:<span class="number">203071</span>] 顾客甲给收银员钱</span><br><span class="line"><span class="number">2017</span><span class="number">-09</span><span class="number">-21</span> <span class="number">17</span>:<span class="number">09</span>:<span class="number">07.351</span> MvvmDemo[<span class="number">1494</span>:<span class="number">203071</span>] RACSignal sendNext: 买到包子</span><br><span class="line"><span class="number">2017</span><span class="number">-09</span><span class="number">-21</span> <span class="number">17</span>:<span class="number">09</span>:<span class="number">07.351</span> MvvmDemo[<span class="number">1494</span>:<span class="number">203071</span>] 顾客甲买到包子</span><br><span class="line"><span class="number">2017</span><span class="number">-09</span><span class="number">-21</span> <span class="number">17</span>:<span class="number">09</span>:<span class="number">08.350</span> MvvmDemo[<span class="number">1494</span>:<span class="number">203071</span>] RACSignal sendNext: 给收银员钱</span><br><span class="line"><span class="number">2017</span><span class="number">-09</span><span class="number">-21</span> <span class="number">17</span>:<span class="number">09</span>:<span class="number">08.351</span> MvvmDemo[<span class="number">1494</span>:<span class="number">203071</span>] 顾客乙给收银员钱</span><br><span class="line"><span class="number">2017</span><span class="number">-09</span><span class="number">-21</span> <span class="number">17</span>:<span class="number">09</span>:<span class="number">08.351</span> MvvmDemo[<span class="number">1494</span>:<span class="number">203071</span>] RACSignal sendNext: 买到包子</span><br><span class="line"><span class="number">2017</span><span class="number">-09</span><span class="number">-21</span> <span class="number">17</span>:<span class="number">09</span>:<span class="number">08.351</span> MvvmDemo[<span class="number">1494</span>:<span class="number">203071</span>] 顾客乙买到包子</span><br><span class="line"><span class="number">2017</span><span class="number">-09</span><span class="number">-21</span> <span class="number">17</span>:<span class="number">09</span>:<span class="number">09.648</span> MvvmDemo[<span class="number">1494</span>:<span class="number">203071</span>] RACSignal sendNext: 没买到包子</span><br><span class="line"><span class="number">2017</span><span class="number">-09</span><span class="number">-21</span> <span class="number">17</span>:<span class="number">09</span>:<span class="number">09.648</span> MvvmDemo[<span class="number">1494</span>:<span class="number">203071</span>] 顾客丙没买到包子</span><br></pre></td></tr></table></figure>

<p>可以看到一开始创建RACSignal的时候没有触发买包子流程，每有一个新的顾客来就会触发一个新的流程，流程也可能走向不同的结果。</p>
<h1 id="误用的隐患"><a href="#误用的隐患" class="headerlink" title="误用的隐患"></a>误用的隐患</h1><h2 id="冷信号流容易导致的问题"><a href="#冷信号流容易导致的问题" class="headerlink" title="冷信号流容易导致的问题"></a>冷信号流容易导致的问题</h2><p>冷信号流是用于一对一环境的，为每个订阅者都重新执行一次独立的信号流。因此，冷信号流可能无意中被订阅很多次，重复运行很多次。看下面的代码：</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">RACSignal *signal = [RACSignal createSignal:^RACDisposable * _Nullable(<span class="keyword">id</span>&lt;RACSubscriber&gt;  _Nonnull subscriber) &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"触发一次信号流"</span>);</span><br><span class="line">    [subscriber sendCompleted];</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">&#125;];</span><br><span class="line"></span><br><span class="line">[[signal flatten] subscribeNext:^(<span class="keyword">id</span>  _Nullable x) &#123; &#125;];</span><br><span class="line">[[signal map:^<span class="keyword">id</span> _Nullable(<span class="keyword">id</span>  _Nullable value) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">&#125;] subscribeNext:^(<span class="keyword">id</span>  _Nullable x) &#123; &#125;];</span><br></pre></td></tr></table></figure>

<p>这例子里的RACSignal的<code>flatten</code>和<code>map:</code>等方法其实也是通过订阅原信号流进行转换后再输出的，所以这里是会打印出两次『触发一次信号流』的。这种情况的增多，就更容易导致冷信号流被订阅次数增加。</p>
<p>在这种前提下，我们就要注意以下情况下不能滥用冷信号流：</p>
<ol>
<li>信号体内有耗时的运算逻辑，如多次运行会造成性能问题。</li>
<li>信号体内逻辑实际上不期望多次运行，如多次运行会出错。</li>
</ol>
<p>这时候我们可以用热信号流替代冷信号流，或者将冷信号流通过<code>publish</code>或者<code>multicast:</code>转换成RACMulticastConnection后进行热信号流式的一对多转发。这细节就不在此展开了，只给个示例：</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">RACMulticastConnection *connection = [[RACSignal createSignal:^RACDisposable * _Nullable(<span class="keyword">id</span>&lt;RACSubscriber&gt;  _Nonnull subscriber) &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"触发一次信号流"</span>);</span><br><span class="line">    [subscriber sendCompleted];</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">&#125;] publish];</span><br><span class="line"></span><br><span class="line">[[connection.signal flatten] subscribeNext:^(<span class="keyword">id</span>  _Nullable x) &#123; &#125;];</span><br><span class="line">[[connection.signal map:^<span class="keyword">id</span> _Nullable(<span class="keyword">id</span>  _Nullable value) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">&#125;] subscribeNext:^(<span class="keyword">id</span>  _Nullable x) &#123; &#125;];</span><br><span class="line"></span><br><span class="line">[connection connect];</span><br></pre></td></tr></table></figure>

<h2 id="热信号流容易导致的问题"><a href="#热信号流容易导致的问题" class="headerlink" title="热信号流容易导致的问题"></a>热信号流容易导致的问题</h2><p>热信号流的问题就在于后订阅的订阅者可能丢失之前的某些信号，如果确实需要之前的某些信号时，可以使用RACBehaviorSubject或RACReplaySubject来完成。当然要注意的是，使用这两个类的时候，就只能关注信号的值而不能关心信号发生的时间了，因为时间在replay过程中已经被破坏了。</p>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>总结起来，热信号流就像直播视频，冷信号流就像点播视频。正确的使用它们，是用好RAC的基础。</p>
<p>大家加油，有问题的欢迎共同讨论哦。</p>
</div></article></div></main><footer><div class="paginator"><a href="/2018/02/2018%EF%BC%8C%E6%96%B0%E7%9A%84%E5%BC%80%E5%A7%8B.html" class="prev">上一篇</a><a href="/2017/09/RAC%E4%B8%AD%E7%94%A8RACCommand%E5%A4%84%E7%90%86%E6%8C%87%E4%BB%A4.html" class="next">下一篇</a></div><div id="disqus_thread"></div><script>var disqus_shortname = 'ping-guo-li-de-bo-ke';
var disqus_identifier = '2017/09/RAC中的冷信号与热信号.html';
var disqus_title = 'RAC中的冷信号与热信号';
var disqus_url = 'https://blog.harrisonxi.com/2017/09/RAC中的冷信号与热信号.html';
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//ping-guo-li-de-bo-ke.disqus.com/count.js" async></script><div class="copyright"><p>© 2017 - 2024 <a href="https://blog.harrisonxi.com">苹果梨</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-110376743-1",'auto');ga('send','pageview');</script></body></html>